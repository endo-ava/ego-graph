# Maestro Flow Case 1: New Chat Creation
#
# 前提条件 (Prerequisites):
# - アプリがインストールされていること
# - APIサーバーが起動していること (http://localhost:8000)
# - 有効なAPI認証情報が設定されていること
# - デバイス/エミュレータからバックエンドにアクセスできること
#
# フロー概要 (Flow Overview):
# 1. アプリ起動
# 2. サイドバーを開く（必要に応じて）
# 3. 新規チャットボタンをタップ
# 4. メッセージを入力
# 5. メッセージを送信
# 6. AI応答の表示を確認
#
# 注意事項 (Notes):
# - LLMの応答は非決定的であるため、正確なテキストではなくUI状態の変化を検証する
# - アプリがサイドバーナビゲーションが利用可能な状態で起動することを想定

appId: dev.egograph.app

---
# 1. アプリ起動
- stopApp
- waitForAnimationToEnd
- launchApp
- waitForAnimationToEnd

# チャット画面初期描画を待つ
- extendedWaitUntil:
    visible:
      id: "chat_input_field"
    timeout: 15000

# 2. サイドバーを開く（左から右へスワイプ）
- swipe:
    start: "100,500"
    end: "700,500"
    duration: 350

# サイドバーのアニメーションを待機
- waitForAnimationToEnd

# サイドバー要素の表示を待機
- extendedWaitUntil:
    visible:
      id: "new_chat_button"
    timeout: 10000

# 3. 新規チャットボタンをタップ
- tapOn:
    id: "new_chat_button"

# 4. チャット入力フィールドが表示されていることを確認（新規チャット作成成功）
- assertVisible:
    id: "chat_input_field"

# 5. チャット入力フィールドをタップ
- tapOn:
    id: "chat_input_field"

# 6. テストメッセージを入力
- inputText: "Hello, e2e test!"

# 7. 送信ボタンをタップ
- tapOn:
    id: "send_button"

# 8. AI応答を待機（LLM処理のため長めのタイムアウト）
# アシスタント応答バブルの表示を検証
- extendedWaitUntil:
    visible:
      id: "assistant_message_bubble"
    timeout: 60000

# 9. 送信後もチャット入力が利用可能であることを確認
- assertVisible:
    id: "chat_input_field"
