# Maestro Flow Case 4: Model Selector
#
# 前提条件 (Prerequisites):
# - アプリがインストールされていること
# - APIサーバーが起動していること (http://localhost:8000)
# - 有効なAPI認証情報が設定されていること
# - デバイス/エミュレータからバックエンドにアクセスできること
# - アプリ設定に複数のモデルが構成されていること
#
# フロー概要 (Flow Overview):
# 1. アプリ起動
# 2. モデルセレクターをタップして利用可能なモデルを表示
# 3. モデルリストが表示されていることを確認
# 4. リストからモデルを選択
# 5. 選択したモデルで新規チャット作成
# 6. メッセージを入力して送信
# 7. AI応答の表示を確認
#
# 注意事項 (Notes):
# - モデル名は環境と設定によって異なる
# - このフローはモデル切り替え機能をテストし、特定のモデルの動作はテストしない
# - LLMの応答は非決定的であるため、正確なテキストではなくUI状態の変化を検証する
# - 実際にタップするモデル名は環境設定に基づいて調整すること

appId: dev.egograph.app

---
# 1. アプリ起動
- stopApp
- launchApp

# アプリ起動後の安定待機
- waitForAnimationToEnd

# チャット画面初期描画を待つ
- extendedWaitUntil:
    visible:
      id: "chat_input_field"
    timeout: 15000

# 2. モデルセレクターをタップしてモデル選択ドロップダウンを開く
- extendedWaitUntil:
    visible:
      id: "model_selector"
    timeout: 10000
- tapOn:
    id: "model_selector"

# 3. モデルセレクターUIが表示されていることを確認（モデルリストが表示されるはず）
# Note: 一部の実装では、model_list は別要素の場合がある
- assertVisible:
    id: "model_selector"

# 4. リストからモデルを選択
# モデル名は環境依存のため、ここではセレクター開閉のみを確認
- tapOn:
    id: "model_selector"

# 5. 選択したモデルで新規チャットを作成
- swipe:
    start: "100,500"
    end: "700,500"
    duration: 350
- waitForAnimationToEnd
- extendedWaitUntil:
    visible:
      id: "new_chat_button"
    timeout: 10000
- tapOn:
    id: "new_chat_button"

# 6. チャット入力フィールドが利用可能であることを確認（選択したモデルで新規チャット作成成功）
- assertVisible:
    id: "chat_input_field"

# 7. チャット入力フィールドをタップ
- tapOn:
    id: "chat_input_field"

# 8. テストメッセージを入力
- inputText: "model selector test"

# 9. 送信ボタンをタップ
- tapOn:
    id: "send_button"

# 10. AI応答を待機（LLM処理のため長めのタイムアウト）
# Note: UI状態の変化（メッセージリストの更新）を確認し、特定の応答テキストは検証しない
- waitForAnimationToEnd

# 11. 送信後もチャット入力が利用可能であることを確認
- assertVisible:
    id: "chat_input_field"
