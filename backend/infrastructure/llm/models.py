"""LLM統合用のデータモデル。

複数のLLMプロバイダー間で統一されたインターフェースを提供します。
"""

from typing import Any, Literal

from pydantic import BaseModel


class Message(BaseModel):
    """チャットメッセージ。

    Attributes:
        role: メッセージの送信者（user, assistant, system, tool）
        content: メッセージ本文（文字列またはAnthropicのtool_result形式のリスト）
        tool_call_id: ツール結果メッセージ用のID（OpenAI形式）
        name: ツール名（OpenAI形式のtool結果メッセージ用）
        tool_calls: assistantメッセージに含まれるツール呼び出し
            （ToolCallオブジェクトのリスト）
    """

    role: Literal["user", "assistant", "system", "tool"]
    # tool callsのみの場合はNoneを許可
    content: str | list[dict[str, Any]] | None = None
    tool_call_id: str | None = None  # OpenAI tool result用
    name: str | None = None  # OpenAI tool result用のツール名
    # assistant messageのtool_calls（ToolCallオブジェクトのリスト）
    tool_calls: list["ToolCall"] | None = None


class ToolCall(BaseModel):
    """LLMからのツール呼び出しリクエスト。"""

    id: str
    name: str
    parameters: dict[str, Any]


class ChatResponse(BaseModel):
    """統一されたチャットレスポンス。

    各プロバイダーのレスポンスをこの形式に変換します。
    """

    id: str
    message: Message
    tool_calls: list[ToolCall] | None = None
    # tokens情報（プロバイダーによって構造が異なる）
    usage: dict[str, Any] | None = None
    finish_reason: str
