# プロジェクト概要

## 1. EgoGraphとは

**EgoGraph**は、個人のあらゆるデジタルデータを統合し、プライバシーを考慮した「分身RAG（Retrieval-Augmented Generation）」システムです。

音楽再生履歴、購買記録、メモ、位置情報など、散在するデジタルフットプリントを**最適な形式（SQL + Vector）**で保持・活用する基盤を作り、これを用いた高度なパーソナルアシスタント機能を実現します。

---

## 2. プロジェクトの目的

### 2.1 ビジョン

「自分自身のデジタル分身を構築し、過去の自分と対話・分析できる未来を創る」

### 2.2 解決する課題

| 課題 | EgoGraphによる解決 |
|---|---|
| **データの散在** | 複数サービスのデータを統一基盤（Supabase）で管理 |
| **検索の限界** | 「回数」「合計」などの正確な事実検索と、あいまいな意味検索の両立 |
| **文脈の喪失** | ログから「要約」を生成し、文脈（Context）として保存 |
| **プライバシーリスク** | 自己管理DBとクラウドの適切な使い分け |

### 2.3 ユースケース

#### 個人用途

- 「先週読んだ記事のタイトルは？」
- 「去年の今頃何してた？」
- 「最近買ったガジェットのリスト」
- 「あの人に送ったメールの内容」

#### 分析用途

- 月次の支出傾向分析
- 音楽の嗜好変化の可視化
- 時間の使い方の振り返り

#### クリエイティブ用途

- 過去の経験をベースにした創作
- 自分史の自動生成

---

## 3. 基本方針（Design Philosophy）

### 3.1 ハイブリッド・アーキテクチャ (Structured vs Unstructured)

RAGの限界（分析ができない）を克服するため、**構造化データと非構造化データの保存先を明確に分離**します。

```
┌─────────────────────────────────┐
│ User Query                      │
│ 「先月いくら使った？楽しいことあった？」 │
└───────────────┬─────────────────┘
                │
        ┌───────▼────────┐
        │ Agent (Router) │
        └───────┬────────┘
                │
   ┌────────────┴─────────────┐
   ▼                          ▼
┌──────────────────┐       ┌──────────────────────┐
│ Analytics (SQL)  │       │ Semantic Search (Vec)│
│ Supabase         │       │ Qdrant               │
│                  │       │                      │
│ - "Facts"        │       │ - "Meaning"          │
│ - 正確な集計     │       │ - あいまい検索       │
│ - 生ログ全件     │       │ - 要約・メモ         │
└──────────────────┘       └──────────────────────┘
```

### 3.2 Agentic Approach

「検索して終わり」ではなく、LLMが**ツール（SQL Client, Vector Search）** を自律的に使い分けて回答を作成する「エージェント型」システムを目指します。

---

## 4. MVP（Minimum Viable Product）定義

### 4.1 MVP の範囲

**第一段階のMVPでは、Spotifyの視聴履歴統合と、基本的なAgent機能（SQL+Vector）の実装を目指します。**

#### MVP で実現すること

- [ ] **Data Warehouse**: Supabase上に `events` テーブル構築
- [ ] **Collector**: Spotify APIから再生履歴を取得しSupabaseへ格納
- [ ] **Summarizer**: 1日分の履歴から「要約」を生成しQdrantへ保存
- [ ] **Agent**: 定型的な質問（「最近聴いた曲」）にSQLで、「雰囲気」にVectorで答える簡易エージェント

### 4.2 MVP の成功基準

1. **正確性**: 「昨日何曲聴いた？」に対してSQLで正確な数字（例：42曲）が返る。
2. **想起**: 「悲しい時に聴いた曲」に対して、要約経由で適切な曲状が返る。

---

## 5. アーキテクチャの全体像

詳細は[システムアーキテクチャ](../10.architecture/1001_system_architecture.md)を参照。

---

## 6. 開発ロードマップ

### Phase 1: MVP（Agile RAG）
- Supabase / Qdrant Cloud セットアップ
- Spotify Collector
- 簡易Agent実装

### Phase 2: 分析と構造化データの拡充
- Bank, Amazon, Calendar等の構造化データ統合
- 複雑なSQLクエリに対応できるAgentの強化

### Phase 3: 非構造化データとChunking
- Note, Email等のテキストデータ統合
- 高度なChunking戦略

---

## 7. プロジェクト構造

```
ego-graph/
├── docs/                    # ドキュメント
├── ingest/                  # データ収集
│   ├── spotify/             # Spotify Collector
│   └── shared/              # Supabase Client等
├── backend/                 # FastAPI (Agent)
└── .github/                 # Actions Workflows
```

---

## 参考

- [システムアーキテクチャ](../10.architecture/1001_system_architecture.md)
- [データモデル](../10.architecture/1002_data_model.md)
