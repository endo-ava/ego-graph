# データソース別設計ドキュメント

## 概要

このディレクトリには、各データソースごとの詳細設計を記載する。
すべてのデータソースは[全体アーキテクチャ](../1001_system_architecture.md)で定義されたLexia標準スキーマに準拠する。

---

## データソース一覧

### 実装済み

| No. | データソース | ドキュメント | データタイプ | 優先度 |
|---|---|---|---|---|
| 01 | Spotify | [01_spotify.md](./01_spotify.md) | 構造化ログ | MVP |
| 02 | Last.fm | [02_lastfm.md](./02_lastfm.md) | 外部メタデータ | MVP |

### 実装予定

| No. | データソース | ドキュメント | データタイプ | 優先度 |
|---|---|---|---|---|
| 03 | Bank（銀行取引） | [03_bank.md](./03_bank.md) | 構造化ログ | Phase 1 |
| 04 | Amazon（購買履歴） | [03_amazon.md](./03_amazon.md) | 構造化ログ | Phase 1 |
| 05 | Calendar（カレンダー） | [04_calendar.md](./04_calendar.md) | 構造化ログ | Phase 1 |
| 06 | Note（メモ） | [05_note.md](./05_note.md) | 非構造化データ | Phase 2 |
| 07 | Email | [06_email.md](./06_email.md) | 非構造化データ | Phase 2 |
| 08 | Browser History | [07_browser.md](./07_browser.md) | 時系列・行動履歴 | Phase 3 |
| 09 | Location | [08_location.md](./08_location.md) | 時系列・行動履歴 | Phase 3 |

---

## データソース設計の標準構成

各データソースの設計書は以下の構成に従う：

### 1. 概要

- データの性質（構造化/非構造化/時系列）
- 粒度（Atomic/Summary/Chunk）
- 更新頻度
- センシティビティレベル

### 2. 入力データ構造

- 取得元（API、Export、手動入力）
- フィールド一覧と説明

### 3. Semantification戦略（構造化データの場合）

- 自然言語化テンプレート
- テンプレート選択基準
- 出力例

### 4. チャンキング戦略（非構造化データの場合）

- 分割単位（段落/文/トークン数）
- ウィンドウサイズ
- 親子関係の構築方法

### 5. メタデータマッピング

- Lexia標準スキーマへの対応表
- センシティビティ判定ロジック

### 6. 要約ノード生成（該当する場合）

- 集約単位（日次/週次/月次）
- 要約内容の定義

### 7. 検索シナリオ例

- 典型的な質問とその検索戦略

### 8. データ取り込みフロー

- データソースからQdrantまでの処理フロー図

### 9. 実装時の考慮事項

- エッジケース
- パフォーマンス最適化
- 将来拡張

### 10. サンプルデータ

- 入力データ例
- 変換後のTextNode例

---

## 実装ガイドライン

### データソース追加手順

1. **テンプレートをコピー**
   - [_template.md](./_template.md)をコピーして新規ファイル作成

2. **各セクションを埋める**
   - データソースの特性に合わせて記述

3. **サンプルデータで検証**
   - 実際のデータを1〜2件取り込み、動作確認

4. **このREADMEを更新**
   - 一覧表に追加

### 共通の注意点

#### Semantification（構造化データ）

- **シンプルに**：検索用テキストは簡潔に
- **日本語自然**：「〜した」「〜を購入」など自然な表現
- **冗長性を持たせる**：検索キーワードを複数含める
  - 例：「Amazonで購入」→「Amazonで〜を購入した」「注文した」

#### チャンキング（非構造化データ）

- **文脈を保持**：前後N文を含めるウィンドウ設定
- **粒度を明示**：ChunkノードにはChunk、親ノードにはSummaryをセット

#### センシティビティ判定

- **保守的に**：迷ったら高めのレベルを設定
- **明示的なキーワード**：Bank, Medical, Adultは自動的にHigh

---

## 優先度の定義

| 優先度 | 説明 | 実装タイミング |
|---|---|---|
| **MVP** | 最初に実装する最小構成 | Phase 1の開始時 |
| **Phase 1** | 基本的な構造化データ | MVPの次 |
| **Phase 2** | 非構造化データの追加 | Phase 1完了後 |
| **Phase 3** | 高度な機能（要約・時系列） | Phase 2完了後 |

---

## 参考

- [データモデル（Lexia標準スキーマ）](../1002_data_model.md)
- [システムアーキテクチャ](../1001_system_architecture.md)
- [Embedding戦略](../../20.technical_selections/01_embedding.md)
